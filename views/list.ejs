<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/main.css" />
  </head>
  <body class="grey-bg">
    <!-- ejs íŒŒì¼ê°„ì˜ ì—°ê²° : include -->
    <%- include('nav.ejs') %>

    <div class="white-bg">
      <% for (let i = 0; i < ê¸€ëª©ë¡.length; i++) { %>
      <div class="list-box">
        <h4>
          <a href="/detail/<%= ê¸€ëª©ë¡[i]._id %>"><%= ê¸€ëª©ë¡[i].title %></a>
          <a href="/edit/<%= ê¸€ëª©ë¡[i]._id %>">âœï¸</a>
          <span class="delete" data-id="<%= ê¸€ëª©ë¡[i]._id %>">ğŸ—‘ï¸</span>
        </h4>
        <p><%= ê¸€ëª©ë¡[i].content %></p>
      </div>
      <% } %>
    </div>

    <script>
      for (let i = 0; i < "<%= ê¸€ëª©ë¡.length %>"; i++) {
        // ì¿¼ë¦¬ ì…€ë ‰í„°ë¡œ í´ë˜ìŠ¤ deleteë¥¼ ì°¾ê³  ê±°ê¸°ì„œ click ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ê²½ìš°
        document.querySelectorAll(".delete")[i].addEventListener("click", function (e) {
          // e.target ëŒ€ì‹  thisë¥¼ ì‚¬ìš©í•˜ì—¬, ì´ë²¤íŠ¸ê°€ ë°”ì¸ë”©ëœ ìš”ì†Œì— ì ‘ê·¼í•©ë‹ˆë‹¤.
          // fetchë¡œ ìš”ì²­ì„ ë‚ ë¦¼ (ê¸°ë³¸ì€ get ìš”ì²­)
          fetch("/doc?docid=" + e.target.dataset.id, { method: "DELETE" }) // ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ í™œìš©
            .then((response) => {
              if (response.status === 200) {
                return response.text(); // ì„œë²„ê°€ 200 OK ì‘ë‹µì„ ë³´ë‚´ë©´ í…ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
              } else {
                // ì„œë²„ê°€ ì—ëŸ¬ ì½”ë“œë¥¼ ì „ì†¡í–ˆì„ ë•Œ ì‹¤í–‰í•  ì½”ë“œ
                alert("ì„œë²„ ì—ëŸ¬ ë°œìƒ: " + response.statusText);
                throw new Error("Server responded with status: " + response.status);
              }
            })
            .then((text) => {
              // ì„±ê³µ ì‹œ ì‹¤í–‰í•  ì½”ë“œ
              alert(text);
              e.target.parentElement.parentElement.style.display = "none";
            })
            .catch((error) => {
              // ì¸í„°ë„· ë¬¸ì œ ë“±ìœ¼ë¡œ ì‹¤íŒ¨ ì‹œ ì‹¤í–‰í•  ì½”ë“œ
              alert("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + error.message);
              console.error("Fetch error:", error);
            });
        });
      }
    </script>
  </body>
</html>
